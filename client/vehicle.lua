VehiclePlaces = {
	{
		blip = nil,
		buy = { ['x'] = -343.45639038086, ['y'] = -132.33348083496, ['z'] = 39.009662628174 },
		spawn = { ['x'] = -327.06130981445, ['y'] = -144.24142456055, ['z'] = 38.51216506958, ['heading'] = 69.032455444336 },
		settings = Settings.carSettings
	},

	{
		blip = nil,
		buy = { ['x'] = 729.28601074219, ['y'] = -1066.1860351563, ['z'] = 22.168672561646 },
		spawn = { ['x'] = 735.82940673828, ['y'] = -1072.2227783203, ['z'] = 21.575220108032, ['heading'] = 180.48377990723 },
		settings = Settings.carSettings
	},

	{
		blip = nil,
		buy = { ['x'] = -1149.4119873047, ['y'] = -2004.0108642578, ['z'] = 13.180257797241 },
		spawn = { ['x'] = -1167.2578125, ['y'] = -2013.4609375, ['z'] = 12.762152671814, ['heading'] = 314.74981689453 },
		settings = Settings.carSettings
	},

	{
		blip = nil,
		buy = { ['x'] = 1173.8170166016, ['y'] = 2638.5112304688, ['z'] = 37.769218444824 },
		spawn = { ['x'] = -1167.2578125, ['y'] = -2013.4609375, ['z'] = 12.762152671814, ['heading'] = 314.74981689453 },
		settings = Settings.carSettings
	},

	{
		blip = nil,
		buy = { ['x'] = 110.07620239258, ['y'] = 6628.943359375, ['z'] = 31.787239074707 },
		spawn = { ['x'] = 103.63438415527, ['y'] = 6622.7026367188, ['z'] = 31.228212356567, ['heading'] = 224.52452087402 },
		settings = Settings.carSettings
	},

	-- {
	-- 	blip = nil,
	-- 	buy = { ['x'] = -990.20458984375, ['y'] = -2988.85546875, ['z'] = 13.945067405701 },
	-- 	spawn = { ['x'] = -978.53314208984, ['y'] = -2995.2180175781, ['z'] = 13.44655418396, ['heading'] = 62.393993377686 },
	-- 	settings = Settings.planeSettings
	-- },

	-- {
	-- 	blip = nil,
	-- 	buy = { ['x'] = -1109.9969482422, ['y'] = -2892.8879394531, ['z'] = 13.945918083191 },
	-- 	spawn = { ['x'] = -1112.2124023438, ['y'] = -2883.5236816406, ['z'] = 13.449026107788, ['heading'] = 149.9224395752 },
	-- 	settings = Settings.heliSettings
	-- },

	-- {
	-- 	blip = nil,
	-- 	buy = { ['x'] = 1736.4291992188, ['y'] = 3292.0109863281, ['z'] = 41.154109954834 },
	-- 	spawn = { ['x'] = 1733.1650390625, ['y'] = 3303.8383789063, ['z'] = 40.929485321045, ['heading'] = 193.91323852539 },
	-- 	settings = Settings.planeSettings
	-- },

	-- {
	-- 	blip = nil,
	-- 	buy = { ['x'] = 1760.5240478516, ['y'] = 3245.6018066406, ['z'] = 41.792789459229 },
	-- 	spawn = { ['x'] = 1770.310546875, ['y'] = 3239.7893066406, ['z'] = 41.843734741211, ['heading'] = 104.2003326416 },
	-- 	settings = Settings.heliSettings
	-- },

	-- {
	-- 	blip = nil,
	-- 	buy = { ['x'] = 2127.1784667969, ['y'] = 4799.1000976563, ['z'] = 41.162982940674 },
	-- 	spawn = { ['x'] = 2133.2607421875, ['y'] = 4784.4477539063, ['z'] = 40.678649902344, ['heading'] = 23.563682556152 },
	-- 	settings = Settings.planeSettings
	-- },

	-- {
	-- 	blip = nil,
	-- 	buy = { ['x'] = 2093.9289550781, ['y'] = 4775.4047851563, ['z'] = 41.251644134521 },
	-- 	spawn = { ['x'] = 2102.5183105469, ['y'] = 4767.212890625, ['z'] = 40.909629821777, ['heading'] = 98.875396728516 },
	-- 	settings = Settings.heliSettings
	-- },

	-- {
	-- 	blip = nil,
	-- 	buy = { ['x'] = -1867.6484375, ['y'] = -1203.7532958984, ['z'] = 13.017106056213 },
	-- 	spawn = { ['x'] = -1883.8277587891, ['y'] = -1196.5783691406, ['z'] = 2.0171060562134, ['heading'] = 325.5 },
	-- 	settings = Settings.boatSettings
	-- },

	-- {
	-- 	blip = nil,
	-- 	buy = { ['x'] = -997.04089355469, ['y'] = -1360.03515625, ['z'] = 5.0001788139343 },
	-- 	spawn = { ['x'] = -984.25183105469, ['y'] = -1366.7669677734, ['z'] = 1.0001788139343, ['heading'] = 106.49999237061 },
	-- 	settings = Settings.boatSettings
	-- },

	-- {
	-- 	blip = nil,
	-- 	buy = { ['x'] = -740.29418945313, ['y'] = -2814.4045410156, ['z'] = 13.940433502197 },
	-- 	spawn = { ['x'] = -713.63189697266, ['y'] = -2804.5100097656, ['z'] = 3.9404335021973, ['heading'] = 196.4998626709 },
	-- 	settings = Settings.boatSettings
	-- },

	-- {
	-- 	blip = nil,
	-- 	buy = { ['x'] = -3426.345703125, ['y'] = 967.71655273438, ['z'] = 8.3466835021973 },
	-- 	spawn = { ['x'] = -3444.9780273438, ['y'] = 967.7353515625, ['z'] = 2.5722370147705, ['heading'] = 1.5010634660721 },
	-- 	settings = Settings.boatSettings
	-- },

	-- {
	-- 	blip = nil,
	-- 	buy = { ['x'] = 3113.4921875, ['y'] = 2158.029296875, ['z'] = 32.463645935059 },
	-- 	spawn = { ['x'] = 3088.3295898438, ['y'] = 2139.9675292969, ['z'] = 2.2830677032471, ['heading'] = 344.99996948242 },
	-- 	settings = Settings.boatSettings
	-- },

	-- {
	-- 	blip = nil,
	-- 	buy = { ['x'] = -278.99493408203, ['y'] = 6633.2573242188, ['z'] = 7.4705123901367 },
	-- 	spawn = { ['x'] = -291.84033203125, ['y'] = 6643.0385742188, ['z'] = 3.5301523208618, ['heading'] = 308.99987792969 },
	-- 	settings = Settings.boatSettings
	-- },
}


local vehicleShopColor = Color.GetHudFromBlipColor(Color.Purple)


AddEventHandler('lsv:firstSpawnPlayer', function()
	for _, vehiclePlace in pairs(VehiclePlaces) do
		vehiclePlace.blip = Map.CreatePlaceBlip(vehiclePlace.settings.blipId, vehiclePlace.buy.x, vehiclePlace.buy.y, vehiclePlace.buy.z)
	end
end)

--TODO Too similar to another places - refactor?
Citizen.CreateThread(function()
	WarMenu.CreateMenu('vehicleShop', 'Vehicle Shop')
	WarMenu.SetTitleBackgroundColor('vehicleShop', vehicleShopColor.r, vehicleShopColor.g, vehicleShopColor.b)
	WarMenu.SetMenuButtonPressedSound('vehicleShop', 'WEAPON_PURCHASE', 'HUD_AMMO_SHOP_SOUNDSET')

	local currentMenuIndex = nil

	while true do
		if GetPlayerWantedLevel(PlayerId()) == 0 and Player.initialized then
			for index, vehiclePlace in pairs(VehiclePlaces) do
				DrawMarker(1, vehiclePlace.buy.x, vehiclePlace.buy.y, vehiclePlace.buy.z - 1, 0, 0, 0, 0, 0, 0, 1.0, 1.0, 1.0, vehicleShopColor.r, vehicleShopColor.g, vehicleShopColor.b, 196, false, nil, nil, false)

				if Vdist(vehiclePlace.buy.x, vehiclePlace.buy.y, vehiclePlace.buy.z, table.unpack(GetEntityCoords(GetPlayerPed(-1), true))) < 1.0 then
					if Player.vehicle and Player.vehicleBlip then
						Gui.DisplayHelpTextThisFrame('You already own a vehicle.')
					else
						if IsControlJustReleased(0, 38) then
							WarMenu.SetSubTitle('vehicleShop', vehiclePlace.settings.name)
							currentMenuIndex = index
							WarMenu.OpenMenu('vehicleShop')
						end

						if WarMenu.IsMenuOpened('vehicleShop') then
							for _, purchasedVehicle in pairs(vehiclePlace.settings.vehicles) do
								local price = '$'..tostring(purchasedVehicle.price)
								if purchasedVehicle.hash == Player.vehicleModel then price = 'Owned' end

								if WarMenu.Button(purchasedVehicle.name, price) then
									if purchasedVehicle.hash == Player.vehicleModel then
										Gui.DisplayNotification('You have already purchased this vehicle.')
									elseif Player.IsEnoughMoney(purchasedVehicle.price) then
										Player.vehicleModel = purchasedVehicle.hash
										Player.SpawnVehicle(vehiclePlace.spawn)
										Player.ChangeMoney(-purchasedVehicle.price)
										TriggerServerEvent('lsv:updatePlayerVehicleModel', purchasedVehicle.hash)
										WarMenu.CloseMenu()
									else
										Gui.DisplayNotification('You don\'t have enough money to purchase this vehicle.')
									end
								end
							end

							WarMenu.Display()
						else
							Gui.DisplayHelpTextThisFrame('Press ~INPUT_PICKUP~ to browse '..vehiclePlace.settings.name..'.')
						end
					end
				elseif WarMenu.IsMenuOpened('vehicleShop') and index == currentMenuIndex then
					WarMenu.CloseMenu()
				end
			end
		end

		if Player.vehicle then
			if IsEntityDead(Player.vehicle) then
				Citizen.InvokeNative(0xB736A491E64A32CF, Citizen.PointerValueIntInitialized(Player.vehicle)) --SetEntityAsNoLongerNeeded
				Citizen.InvokeNative(0x86A652570E5F25DD, Citizen.PointerValueIntInitialized(Player.vehicleBlip)) --RemoveBlip

				Gui.DisplayNotification('~r~Your vehicle has been destroyed.')

				Player.vehicle = nil
				Player.vehicleBlip = nil
			elseif Player.vehicleBlip then
				if IsPedInVehicle(GetPlayerPed(-1), Player.vehicle) then
					SetBlipAlpha(Player.vehicleBlip, 0)
				else
					SetBlipAlpha(Player.vehicleBlip, 255)
				end
			end
		end

		Citizen.Wait(0)
	end
end)
